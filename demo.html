<head>
	<!--[if IE]><script type="text/javascript" src="excanvas.js"></script><![endif]-->

<script type='text/javascript'>
window.onload=function(){

function dataFunX(data){
//data=[[1,2],[3,4]];
return data;
}

function dataFunY(data){
//data=[[1,2],[3,4]];
return data;
}

function drawSmartArrow(c,x0,y0,x,y,radius,color)
{

//ÖÇÄÜ¼ýÍ·£»
c.save();
c.strokeStyle=color;
if(y0>y)
var gradient=Math.atan((x-x0)/(y0-y));
else
var gradient=Math.atan((y-y0)/(x-x0));

var gradient_1=gradient-Math.PI/6;
var gradient_2=gradient+Math.PI/6;

if(y0>y)
{

var p1=[x-radius*Math.sin(gradient_1),y+radius*Math.cos(gradient_1)];
var p2=[x-radius*Math.sin(gradient_2),y+radius*Math.cos(gradient_2)];
}
else
{

var p1=[x-radius*Math.cos(gradient_1),y-radius*Math.sin(gradient_1)];
var p2=[x-radius*Math.cos(gradient_2),y-radius*Math.sin(gradient_2)];
}
c.beginPath();

c.moveTo(p1[0],p1[1]);
c.lineTo(x,y);
c.lineTo(p2[0],p2[1]);
c.stroke();
c.restore();
}
function drawCircle(c,x,y,radius,color,fill)
{
//c.beginPath();
if(!fill)
c.strokeStyle=color;
else
c.fillStyle=color;
c.arc(x,y,radius,0,Math.PI*2,true);
if(fill)
c.fill();
else
c.stroke();
//c.closePath();
}
function drawTriangle(c,x,y,side,color,fill)
{
//c.beginPath();
if(!fill)
c.strokeStyle=color;
else
c.fillStyle=color;
var p1=[x,y-Math.pow(3,1/2)/3*side];
var p2=[x-side/2,y+Math.pow(3,1/2)/6*side];
var p3=[x+side/2,y+Math.pow(3,1/2)/6*side];
c.beginPath();
c.moveTo(p1[0],p1[1]);
c.lineTo(p2[0],p2[1]);
c.lineTo(p3[0],p3[1]);
c.closePath();
if(fill)
c.fill();
else
c.stroke();
//c.closePath();
}
function drawFive(c,x,y,side,color,fill)
{
//c.beginPath();
if(!fill)
c.strokeStyle=color;
else
c.fillStyle=color;
var x_add=Math.sin(Math.PI*2/5)*side;
var x_add2=Math.sin(Math.PI*2/10)*side;
var y_add=Math.cos(Math.PI*2/5)*side;
var y_add2=Math.cos(Math.PI*2/10)*side;
var p1=[x-x_add,y-y_add];
var p2=[x+x_add,y-y_add];
var p3=[x-x_add2,y+y_add2];
var p4=[x,y-side];
var p5=[x+x_add2,y+y_add2];
c.beginPath();
c.moveTo(p1[0],p1[1]);
c.lineTo(p2[0],p2[1]);
c.lineTo(p3[0],p3[1]);
c.lineTo(p4[0],p4[1]);
c.lineTo(p5[0],p5[1]);
c.closePath();
if(fill)
c.fill();
else
c.stroke();
//c.closePath();
}


function drwaPlus(c,x,y,side,color)
{
c.strokeStyle=color;
c.save();
//c.lineWidth=.5;
p1=[x-side,y];
p2=[x+side,y];
p3=[x,y-side];
p4=[x,y+side];
c.beginPath();
c.moveTo(p1[0],p1[1]);
c.lineTo(p2[0],p2[1]);
c.closePath();
c.stroke();
c.beginPath();
c.moveTo(p3[0],p3[1]);
c.lineTo(p4[0],p4[1]);
c.closePath();
c.stroke();
c.restore();
}
function drwaCross(c,x,y,side,color)
{
c.strokeStyle=color;
c.save();
//c.lineWidth=.5;
var add=(Math.pow(2,1/2)/2)*side;
p1=[x-add,y-add];
p2=[x+add,y+add];
p3=[x-add,y+add];
p4=[x+add,y-side];
c.beginPath();
c.moveTo(p1[0],p1[1]);
c.lineTo(p2[0],p2[1]);
c.closePath();
c.stroke();
c.beginPath();
c.moveTo(p3[0],p3[1]);
c.lineTo(p4[0],p4[1]);
c.closePath();
c.stroke();
c.restore();
}

 
function barChart(des,data,options){
  var ctx = document.getElementById(des).getContext('2d');  
  var ctx_width=document.getElementById(des).width;
  var ctx_height=document.getElementById(des).height;
  var margin=.95; var text_margin=.03; var text_line=.01;var text_left=.01;
  var xParts=(ctx_width*margin)/(options.maxX-options.minX);
  var yParts=(ctx_height*margin)/(options.maxY-options.minY);
  var left_margin=ctx_width*(1-margin);
  var bottom_margin=ctx_height*margin;
 drawCoo(ctx,ctx_width,ctx_height,margin,text_line,text_margin,text_left,xParts,yParts,options);
//draw
 var width=options.bigPart/3;
for(var j=0;j<data.length;j++)
{
  ctx.strokeStyle=data[j].strokeColor;
  ctx.fillStyle=data[j].fillColor;
  for(var i=0;i<data[j].data.length;i++)
  {
    ctx.beginPath();
  //drawCircle(c,x,y,radius,color);
  var x=left_margin+xParts*(data[j].data[i][0]-options.minX)-width/2;
  var y=ctx_height*margin-(data[j].data[i][1]-options.minY)*yParts;
var  height=(data[j].data[i][1]-options.minY)*yParts;
 // ctx.moveTo(x_beofre,y_before);

 ctx.moveTo(x,y);
ctx.fillRect(x,y,width,height);
//ctx.strokeRect(x,y,width,height);
// ctx.lineTo(x,ctx_height*margin);
ctx.stroke();
  }
 
}
//draw
}


function drawCoo(ctx,ctx_width,ctx_height,margin,text_line,text_margin,text_left,xParts,yParts,options){
//var margin=.95; var text_margin=.03; var text_line=.01;var text_left=.01;
ctx.beginPath(); 
  ctx.moveTo(ctx_width*(1-margin),ctx_height*(1-margin));
    ctx.lineTo(ctx_width*(1-margin),ctx_height*margin);
  ctx.lineTo(ctx_width*margin,ctx_height*margin);
  ctx.stroke();
var xMaxLength=ctx_width*margin;
var yMaxLength=ctx_height*margin;
var xTextPlace=ctx_width*(1-margin);
var yTextPlace=ctx_height*margin;
var xText=options.minX;
var yText=options.minY;
ctx.save();
 ctx.lineWidth=0.2;
 ctx.strokeStyle="rgba(255,16,0,.1)";
//Y part

do{
  ctx.moveTo(xTextPlace,yTextPlace);
  ctx.lineTo(xTextPlace-ctx_width*text_line,yTextPlace);
    if(options.xGrid)
  {
  ctx.lineTo(xMaxLength,yTextPlace);
  }
  ctx.stroke();
  ctx.fillText(options.dataFunY(yText), xTextPlace-ctx_height*text_margin,yTextPlace); 
  yTextPlace-=options.bigPart*yParts;
  yText+=options.bigPart;
 
}
while(yTextPlace>=ctx_height-yMaxLength);
var xTextPlace=ctx_width*(1-margin);
var yTextPlace=ctx_height*margin;
var xText=options.minX;
var yText=options.minY;
//X part
do{
  ctx.moveTo(xTextPlace,yTextPlace);
  ctx.lineTo(xTextPlace,yTextPlace+ctx_height*text_line);
  if(options.yGrid)
  {
  ctx.lineTo(xTextPlace,yParts-yMaxLength);
  }
  ctx.stroke();
  ctx.fillText(options.dataFunX(xText), xTextPlace-ctx_width*text_left,ctx_height*margin+ctx_height*text_margin); 
  xTextPlace+=options.bigPart*xParts;
  xText+=options.bigPart;
}
while(xTextPlace<=xMaxLength);
// draw lines
ctx.closePath();
ctx.restore();
}

function lineChart(des,data,options) {  
  var ctx = document.getElementById(des).getContext('2d');  
  var ctx_width=document.getElementById(des).width;
  var ctx_height=document.getElementById(des).height;
  var margin=.95; var text_margin=.03; var text_line=.01;var text_left=.01;
  var xParts=(ctx_width*margin)/(options.maxX-options.minX);
  var yParts=(ctx_height*margin)/(options.maxY-options.minY);
  var left_margin=ctx_width*(1-margin);
  var bottom_margin=ctx_height*margin;
 drawCoo(ctx,ctx_width,ctx_height,margin,text_line,text_margin,text_left,xParts,yParts,options);
for(var j=0;j<data.length;j++)
{

  ctx.beginPath();
  ctx.strokeStyle=data[j].lineColor;
  ctx.moveTo(left_margin+xParts*(data[j].data[0][0]-options.minX),ctx_height*margin-(data[j].data[0][1]-options.minY)*yParts);
  for(var i=1;i<data[j].data.length;i++)
  {
  //drawCircle(c,x,y,radius,color);
   
  var x=left_margin+xParts*(data[j].data[i][0]-options.minX);
  var y=ctx_height*margin-(data[j].data[i][1]-options.minY)*yParts;
 // ctx.moveTo(x_beofre,y_before);
  ctx.lineTo(x,y);
  }
  ctx.stroke();
}
 //  drawCircle(ctx,x,y,data[j].stressPoint.radius,data[j].stressPoint.color);
for(var j=0;j<data.length;j++)
{
  ctx.beginPath();
 // ctx.moveTo(left_margin+xParts*(data[j].data[0][0]-options.minX),ctx_height*margin-(data[j].data[0][1]-options.minY)*yParts);
  for(var i=0;i<data[j].data.length;i++)
  {
  ctx.beginPath();
  var x=left_margin+xParts*(data[j].data[i][0]-options.minX);
  var y=ctx_height*margin-(data[j].data[i][1]-options.minY)*yParts;
  switch(data[j].stressPoint.style)
  {
  case "circle":
  drawCircle(ctx,x,y,data[j].stressPoint.radius,data[j].stressPoint.color,data[j].stressPoint.fill);
  break;
  case "triangle":
  drawTriangle(ctx,x,y,10,"red",data[j].stressPoint.fill);
   break;
  case "plus":
   drwaPlus(ctx,x,y,data[j].stressPoint.radius,data[j].stressPoint.color);
 break;
  case "cross":
    drwaCross(ctx,x,y,data[j].stressPoint.radius,data[j].stressPoint.color);
	 break;
  case "five":
  drawFive(ctx,x,y,data[j].stressPoint.radius,data[j].stressPoint.color,data[j].stressPoint.fill);
  break;
  case "smartArrow":
  if(i>0)
  {
  var x0=left_margin+xParts*(data[j].data[i-1][0]-options.minX);
  var y0=ctx_height*margin-(data[j].data[i-1][1]-options.minY)*yParts;
    drawSmartArrow(ctx,x0,y0,x,y,data[j].stressPoint.radius,data[j].stressPoint.color);

  }

  break;
}
  }
  
}



} 
function pieChart(des,data,options){
var ctx = document.getElementById(des).getContext('2d');  
var ctx_width=document.getElementById(des).width;
var ctx_height=document.getElementById(des).height;

ctx.translate(ctx_width/2, ctx_height/2);
//draw title;
var titleWidth=options.title.length*5;
ctx.save();
ctx.font = "10px Arial";
ctx.fillText(options.title,-titleWidth/2,-options.width*4/7);
//draw title;
ctx.restore();
var dataSum=0;
for(var i=0;i<data[0].data.length;i++)
{
dataSum+=data[0].data[i][1];
}
var end=0;
var begin=0;
for(var i=0;i<data[0].data.length;i++)
{
ctx.save();
ctx.fillStyle=data[0].parts[i].color;
ctx.beginPath(); 
if(i==0)
{
begin=0;
end=-Math.PI*2*data[0].data[i][1]/dataSum;
}
else
{
begin=begin-Math.PI*2*data[0].data[i-1][1]/dataSum;
end=begin-Math.PI*2*data[0].data[i][1]/dataSum;
}
//alert(Math.PI*2*data[0].data[i][1]/dataSum);

var angle=end-begin;
var outAngle=angle/2+begin;
var outPoint=[];
var textPoint=[];
if(data[0].parts[i].out)
{
outPoint=[Math.cos(outAngle)*options.width/8,Math.sin(outAngle)*options.width/8];
textPoint=[Math.cos(outAngle)*options.width*3/8,Math.sin(outAngle)*options.width*3/8];
}
else
{
outPoint=[0,0];
textPoint=[Math.cos(outAngle)*options.width/4,Math.sin(outAngle)*options.width/4];
}
ctx.moveTo(outPoint[0],outPoint[1]);
ctx.arc(outPoint[0],outPoint[1], options.width/2,begin,end,true);
ctx.lineTo(outPoint[0],outPoint[1]);
ctx.fill(); 
//ctx.stroke(); 
ctx.save();
ctx.fillStyle="white";
ctx.fillText(data[0].data[i][0]+"."+data[0].data[i][1],textPoint[0],textPoint[1]);
ctx.restore();
ctx.restore();

}
}
pieChart("canvas",
[
{
data:[["Jan",100],["Feb",200],["Fif",180],["Sep",110],["Aug",400],["Oct",100]],
parts:[
{color:"red"},
{color:"blue"},
{color:"green"},
{color:"black",
out:true},
{color:"blue"},
{color:"green",
out:true},
],
strokeColor:"black",
fillColor:"blue",
stressPoint:{style:"five",radius:10,color:"blue",fill:true}
}
],{
width:300,
margin:10,
title:"Hello world JSBarChart",
}) ;
}
</script>
<style type='text/css'>
canvas{
border:1px green solid;}
</style>
</head>
<canvas width='600' height='600' id='canvas'>
</canvas>